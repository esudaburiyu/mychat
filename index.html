<!DOCTYPE HTML>
<html>
<head>
  <meta charset="UTF-8">
  <title>node.js chat</title>

<link rel="stylesheet" type="text/css" href="style.css">

  <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.5.1/jquery.min.js"></script>
  <script src="/socket.io/socket.io.js"></script>
  <script type="text/javascript">

$(function (){
//  var s = io.connect(); //リモート
  var s = io.connect('http://localhost:3000'); //ローカル

  //サーバから受け取るイベント
  s.on("connect", function () {});  // 接続時
  s.on("disconnect", function (client) {});  // 切断時
  s.on("S_to_C_message", function (data) { // サーバーからのメッセージを受け取った時
    addMessage(data);
  });

  //jqueryでメッセージを追加
  function addMessage (data,color,size) {
    var msg = data.value.replace( /[!@$%<>'"&|]/g, '' ); //タグ記号とかいくつか削除
    var date = new Date();
    $("<div class='msg'><p>" + date.toLocaleString() + " [" + data.id + "]</p> <p>" + msg + "</p></div>")
    .hide().prependTo("#msg_list").fadeIn(200)
    .mouseover( function(){
      $(this).css("background", "#d35871");
    })
    .mouseout( function(){
      $(this).css("background", "#fcfaf5");
    } );
  }

  //クライアントからイベント送信（イベント名は自由に設定できます）

  $('#sendMessage').click(function() {
    var msg = $("#message").val();
    $("#message").val("");
    s.emit("C_to_S_message", {value: msg});
  });

})
  </script>

</head>
<body>
  <div id="msg_list" style="height:500px; overflow:auto;"></div>
  <form action="" method="post" onsubmit="return false;">
    <input type="text" class="text" style="width:95%; padding:10px" id="message"/>
    <input type="submit" class="button" style="padding:10px" id="sendMessage" value="送信" />
  </form>
</div>
</body>
</html>